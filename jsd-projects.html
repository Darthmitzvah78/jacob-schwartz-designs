<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work — Jacob Schwartz Designs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.3/Sortable.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --black: #0e0806; --white: #faf0ea; --yellow: #ff6b5e; --mid: #8a6658; --border: #201410; --border-heavy: #341e16; }
    html { scroll-behavior: smooth; }
    body { background: var(--black); color: var(--white); font-family: 'Space Grotesk', sans-serif; font-size: 16px; line-height: 1.4; -webkit-font-smoothing: antialiased; }
    * { cursor: none !important; }
    .cursor-dot { position: fixed; width: 6px; height: 6px; background: var(--yellow); border-radius: 50%; pointer-events: none; z-index: 10001; transform: translate(-50%,-50%); transition: width .2s,height .2s,background .2s; }
    .cursor-ring { position: fixed; width: 36px; height: 36px; border: 1px solid rgba(255,107,94,0.5); border-radius: 50%; pointer-events: none; z-index: 10000; transform: translate(-50%,-50%); transition: width .3s,height .3s; }
    .cursor-dot.hover { width: 8px; height: 8px; background: var(--white); }
    .cursor-ring.hover { width: 56px; height: 56px; border-color: rgba(250,240,234,0.4); }
    .curtain { position: fixed; inset: 0; background: var(--black); z-index: 99998; animation: curtainLift 1s cubic-bezier(0.76,0,0.24,1) 0.25s forwards; }
    @keyframes curtainLift { to { transform: translateY(-100%); } }
    .reveal { opacity: 0; transform: translateY(24px); transition: opacity .7s ease, transform .7s ease; }
    .reveal.visible { opacity: 1; transform: translateY(0); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes lineUp { from { transform: translateY(110%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Nav */
    nav { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; border-bottom: 3px solid var(--white); padding: 1.25rem 2rem; position: sticky; top: 0; z-index: 100; background: var(--black); }
    .nav-back { font-size: 0.72rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--mid); text-decoration: none; display: inline-block; transition: color .2s; }
    .nav-back:hover { color: var(--yellow); }
    .nav-back.springing { transition: color .2s, transform .5s cubic-bezier(0.23,1,0.32,1); }
    .nav-logo { text-decoration: none; display: flex; flex-direction: column; gap: .2rem; line-height: 1; }
    .logo-top { font-size: 1.4rem; font-weight: 700; letter-spacing: -0.03em; text-transform: uppercase; color: var(--white); }
    .logo-bottom { font-size: 0.65rem; font-weight: 400; letter-spacing: .3em; text-transform: uppercase; color: var(--yellow); }
    .nav-right { text-align: right; }

    /* Page Header */
    .page-header { padding: 4rem 2rem 3rem; border-bottom: 1px solid var(--border-heavy); display: flex; align-items: flex-end; justify-content: space-between; }
    .page-title { font-size: clamp(3rem, 8vw, 8rem); font-weight: 700; letter-spacing: -0.03em; line-height: 0.9; overflow: hidden; }
    .page-title .line-inner { display: block; opacity: 0; animation: lineUp .85s cubic-bezier(0.16,1,0.3,1) 1.15s forwards; }
    .page-count { font-size: 0.7rem; letter-spacing: .15em; text-transform: uppercase; color: var(--mid); opacity: 0; animation: fadeIn .5s ease 1.5s forwards; }

    /* Project Grid */
    .projects-list { border-bottom: 3px solid var(--white); }
    .project-row { display: grid; grid-template-columns: 3fr 2fr; align-items: stretch; border-bottom: 1px solid var(--border-heavy); text-decoration: none; color: inherit; transition: background .2s; }
    .project-row:last-child { border-bottom: none; }
    .project-row:hover { background: #0a0604; }
    .project-row.flip { grid-template-columns: 2fr 3fr; }
    .project-thumb { overflow: hidden; background: #0d2535; aspect-ratio: 4/3; }
    .project-row.flip .project-thumb { order: 2; border-left: 1px solid var(--border-heavy); }
    .project-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform .6s ease; }
    .project-row:hover .project-thumb img { transform: scale(1.04); }
    .project-info { position: relative; padding: 3rem; display: flex; flex-direction: column; justify-content: space-between; border-left: 1px solid var(--border-heavy); min-height: 340px; }
    .project-row.flip .project-info { order: 1; border-left: none; border-right: 1px solid var(--border-heavy); }
    .project-meta { display: flex; align-items: center; justify-content: space-between; }
    .project-num { font-size: 0.65rem; letter-spacing: .15em; text-transform: uppercase; color: var(--mid); }
    .project-category { font-size: 0.65rem; letter-spacing: .15em; text-transform: uppercase; color: var(--mid); }
    .project-name { font-size: clamp(2rem, 4vw, 4rem); font-weight: 700; letter-spacing: -0.03em; line-height: 0.95; transition: color .2s; }
    .project-row:hover .project-name { color: var(--yellow); }
    .project-arrow { font-size: 1.5rem; color: var(--yellow); opacity: 0; transition: opacity .2s, transform .2s; transform: translateX(-6px); align-self: flex-end; }
    .project-row:hover .project-arrow { opacity: 1; transform: translateX(0); }

    /* Drag handle — only visible in sort mode */
    .drag-handle {
      display: none;
      position: absolute; bottom: 2.75rem; right: 2.75rem;
      width: 2rem; height: 2rem;
      align-items: center; justify-content: center;
      font-size: 1.25rem; line-height: 1;
      color: var(--mid); opacity: 0.5;
      cursor: grab !important;
      transition: color .2s, opacity .2s;
      z-index: 2; user-select: none;
    }
    .drag-handle:hover { color: var(--yellow); opacity: 1; }
    .sort-mode .drag-handle { display: flex; }
    .sort-mode .project-arrow { display: none; }
    .sortable-ghost { opacity: 0.25; }
    .sortable-drag { box-shadow: 0 24px 60px rgba(0,0,0,.7) !important; opacity: 0.95; }

    /* Sort status bar */
    #sort-bar {
      display: none;
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 10000;
      background: var(--black); border-top: 1px solid var(--border-heavy);
      padding: .9rem 2rem;
      align-items: center; justify-content: space-between;
    }
    #sort-bar.visible { display: flex; }
    .sort-bar-hint { font-size: .68rem; letter-spacing: .12em; text-transform: uppercase; color: var(--mid); }
    .sort-bar-hint strong { color: var(--yellow); font-weight: 500; margin-right: .5rem; }
    #sort-status { font-size: .68rem; letter-spacing: .12em; text-transform: uppercase; color: var(--mid); transition: color .4s; }
    #sort-status.saving { color: var(--mid); }
    #sort-status.saved { color: var(--yellow); }
    #sort-status.error { color: #e55; }

    /* Footer */
    footer { display: flex; align-items: center; justify-content: space-between; padding: 1.25rem 2rem; border-top: 3px solid var(--white); }
    .footer-copy { font-size: .7rem; color: var(--mid); }
    .footer-links { display: flex; gap: 2rem; }
    .footer-links a { font-size: .7rem; color: var(--mid); text-decoration: none; transition: color .2s; }
    .footer-links a:hover { color: var(--white); }

    @media (max-width: 768px) {
      .project-row, .project-row.flip { grid-template-columns: 1fr; }
      .project-thumb { aspect-ratio: 16/7; }
      .project-row.flip .project-thumb { order: 0; border-left: none; border-bottom: 1px solid var(--border-heavy); }
      .project-info { border-left: none; border-top: 1px solid var(--border-heavy); min-height: auto; padding: 2rem; }
      .project-row.flip .project-info { order: 0; border-right: none; }
      .project-arrow { display: none; }
    }
    @media (max-width: 600px) {
      nav { grid-template-columns: 1fr 1fr; } .nav-right { display: none; }
      .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; padding: 2rem 1.5rem; }
      .project-info { padding: 1.5rem; }
      footer { flex-direction: column; gap: 1rem; text-align: center; }
    }
  </style>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div class="curtain"></div>
  <nav>
    <a href="jacob-schwartz-designs.html" class="nav-back">← Home</a>
    <a href="jacob-schwartz-designs.html" class="nav-logo"><span class="logo-top">Jacob Schwartz</span><span class="logo-bottom">Designs</span></a>
    <div class="nav-right">
      <button id="sort-login-btn" onclick="window.netlifyIdentity && window.netlifyIdentity.open()" style="display:none; background:none; border:none; font-size:.68rem; letter-spacing:.12em; text-transform:uppercase; color:var(--mid); cursor:pointer !important; font-family:inherit; transition:color .2s; padding:0;">Edit Order</button>
    </div>
  </nav>

  <div class="page-header">
    <h1 class="page-title"><span class="line-inner">Work</span></h1>
    <p class="page-count" id="cms-project-count">— Projects</p>
  </div>

  <div id="cms-projects-list" class="projects-list"></div>

  <div id="sort-bar">
    <p class="sort-bar-hint"><strong>⠿</strong> Drag rows to reorder — saves automatically</p>
    <span id="sort-status"></span>
  </div>

  <footer>
    <p class="footer-copy">© 2026 Jacob Schwartz Designs — Birmingham, AL</p>
    <div class="footer-links"><a href="#">Instagram</a><a href="#">LinkedIn</a></div>
  </footer>

  <div class="cursor-dot" id="cursorDot"></div>
  <div class="cursor-ring" id="cursorRing"></div>

  <script>
    const dot=document.getElementById('cursorDot'),ring=document.getElementById('cursorRing');
    let cx=-100,cy=-100,rx=-100,ry=-100;
    document.addEventListener('mousemove',e=>{cx=e.clientX;cy=e.clientY;dot.style.left=cx+'px';dot.style.top=cy+'px';});
    (function l(){rx+=(cx-rx)*.12;ry+=(cy-ry)*.12;ring.style.left=rx+'px';ring.style.top=ry+'px';requestAnimationFrame(l);})();
    document.querySelectorAll('a').forEach(el=>{el.addEventListener('mouseenter',()=>{dot.classList.add('hover');ring.classList.add('hover');});el.addEventListener('mouseleave',()=>{dot.classList.remove('hover');ring.classList.remove('hover');});});
    document.addEventListener('mouseleave',()=>{cx=-100;cy=-100;});
    const root=document.documentElement;let raf=false;
    document.querySelectorAll('.nav-back').forEach(link=>{link.addEventListener('mouseenter',()=>link.classList.remove('springing'));link.addEventListener('mousemove',e=>{const r=link.getBoundingClientRect();link.style.transform=`translate(${(e.clientX-(r.left+r.width/2))*.38}px,${(e.clientY-(r.top+r.height/2))*.5}px)`;});link.addEventListener('mouseleave',()=>{link.classList.add('springing');link.style.transform='';});});
  </script>

  <script src="./js/cms.js"></script>
  <script>
    // Flags for coordinating identity + project load timing
    var sortUser = null;
    var projectsRendered = false;

    function tryInitSort() {
      if (!sortUser || !projectsRendered) return;
      var list = document.getElementById('cms-projects-list');
      if (!list || list.dataset.sortInit) return;
      list.dataset.sortInit = '1';

      // Add sort-mode class + inject drag handles
      list.classList.add('sort-mode');
      list.querySelectorAll('.project-info').forEach(function(info) {
        var h = document.createElement('div');
        h.className = 'drag-handle';
        h.innerHTML = '⠿';
        info.appendChild(h);
      });

      // Re-attach cursor hover for new handle elements
      list.querySelectorAll('.drag-handle').forEach(function(el) {
        el.addEventListener('mouseenter', function() { dot.classList.add('hover'); ring.classList.add('hover'); });
        el.addEventListener('mouseleave', function() { dot.classList.remove('hover'); ring.classList.remove('hover'); });
      });

      document.getElementById('sort-bar').classList.add('visible');

      Sortable.create(list, {
        handle: '.drag-handle',
        animation: 180,
        ghostClass: 'sortable-ghost',
        dragClass: 'sortable-drag',
        onEnd: function() {
          // Re-apply alternating flip classes after reorder
          list.querySelectorAll('.project-row').forEach(function(row, i) {
            if (i % 2 === 1) row.classList.add('flip');
            else row.classList.remove('flip');
          });
          saveProjectOrder(sortUser);
        }
      });
    }

    function saveProjectOrder(user) {
      var list = document.getElementById('cms-projects-list');
      var newOrder = Array.from(list.querySelectorAll('[data-id]')).map(function(el) {
        return el.getAttribute('data-id');
      });

      var statusEl = document.getElementById('sort-status');
      statusEl.textContent = 'Saving...';
      statusEl.className = 'saving';

      var token = user.token.access_token;
      var apiPath = '/.netlify/git/github/contents/content/projects-order.json';

      // GET current file to retrieve SHA (required for PUT)
      fetch(apiPath, { headers: { Authorization: 'Bearer ' + token } })
        .then(function(r) { return r.json(); })
        .then(function(fileInfo) {
          var newContent = JSON.stringify({ projects: newOrder }, null, 2) + '\n';
          return fetch(apiPath, {
            method: 'PUT',
            headers: { Authorization: 'Bearer ' + token, 'Content-Type': 'application/json' },
            body: JSON.stringify({
              message: 'Update project order',
              content: btoa(unescape(encodeURIComponent(newContent))),
              sha: fileInfo.sha
            })
          });
        })
        .then(function(r) {
          if (!r.ok) throw new Error('Save failed');
          statusEl.textContent = '✓ Saved';
          statusEl.className = 'saved';
        })
        .catch(function() {
          statusEl.textContent = 'Error — try again';
          statusEl.className = 'error';
        });
    }

    // Load projects, then attempt sort init
    loadCmsContent({ page: 'projects', onLoad: function(projects) {
      renderProjectsList(projects);
      document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));
      projectsRendered = true;
      tryInitSort();
    }});

    // Check Netlify Identity for sort mode
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', function(user) {
        if (user) {
          sortUser = user;
          tryInitSort();
        } else {
          var loginBtn = document.getElementById('sort-login-btn');
          if (loginBtn) loginBtn.style.display = 'inline';
          window.netlifyIdentity.on('login', function(u) {
            if (loginBtn) loginBtn.style.display = 'none';
            sortUser = u;
            tryInitSort();
          });
        }
      });

      // Fallback: init event sometimes fires before listener is set up
      setTimeout(function() {
        if (!sortUser) {
          var u = window.netlifyIdentity.currentUser();
          if (u) { sortUser = u; tryInitSort(); }
        }
      }, 800);
    }
  </script>
</body>
</html>
